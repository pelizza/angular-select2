angular.module("rt.select2",[]).value("select2Config",{}).directive("select2",["$rootScope","$timeout","$parse","$filter","select2Config",function(a,b,c,d,e){"use strict";function f(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var g=d("filter"),h={},i=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return e&&angular.extend(h,e),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(a,d,e,j){function k(b){if(q){var c=q(a);if(c)return g(b,c)}return b}function l(a){m(o?function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=j.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}a(c)}:function(){a(n.emptyItem&&!j.$viewValue?n.emptyItem:r[j.$viewValue]||{obj:{}})})}var m,n=angular.extend({},h,a.$eval(e.options));e.emptyItem&&(n.emptyItem={id:"EMPTY_ITEM",text:e.emptyItem});var o=angular.isDefined(e.multiple)||n.multiple;n.multiple=o,e.placeholder&&(n.placeholder=e.placeholder);var p=c(e.ngModel),q=c(e.optionsFilter),r={};if(e.ngOptions){var s;if(!(s=e.ngOptions.match(i)))throw new Error("Invalid ngOptions encountered!");var t=c(s[2]||s[1]),u=c(s[7]),v=s[4]||s[6],w=c(s[2]?s[1]:v),x=s[5];m=function(b){var c=k(u(a)),d=(x?f(c):c)||[],e=[];n.emptyItem&&(r[n.emptyItem.id]=n.emptyItem,e.push(n.emptyItem));for(var g=0;g<d.length;g++){var h={},i=g;x&&(i=d[g],h[x]=i),h[v]=c[i];var j=w(a,h),l=t(a,h)||"";r[j]={id:j,text:l,obj:c[i]},e.push(r[j])}b(e)},n.query=function(b){var c=k(u(a)),d=(x?f(c):c)||[],e=[];""===b.term&&n.emptyItem&&e.push(n.emptyItem);for(var g=0;g<d.length;g++){var h={},i=g;x&&(i=d[g],h[x]=i),h[v]=c[i];var j=w(a,h),l=t(a,h)||"";l.toLowerCase().indexOf(b.term.toLowerCase())>-1&&e.push({id:j,text:l,obj:c[i]})}b.callback({results:e})},a.$watch(s[7],function(){j.$render()})}else{if(!n.query)throw new Error("You need to supply a query function!");var y=n.query;n.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];r[d.id]=d}b(a)},y(a)},m=function(a){n.query({term:"",callback:function(b){a(b.results)}})}}if(j.$render=function(){l(function(a){o?d.select2("data",a):d.select2("val",a.id)})},n.initSelection){var z=n.initSelection;n.initSelection=function(a,b){z(a,function(a){r[a.id]=a,b(a)})}}else n.initSelection=function(a,b){l(b)};b(function(){d.select2(n),d.on("change",function(b){a.$apply(function(){var c;if(o){for(var d=[],e=0;e<b.val.length;e++)c=r[b.val[e]],c&&d.push(c.id);p.assign(a,d)}else n.emptyItem&&b.val===n.emptyItem.id?p.assign(a,null):(c=r[b.val],p.assign(a,c?c.id:null))})}),j.$render()})}}}]);